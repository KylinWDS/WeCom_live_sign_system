# 启动器 (launcher.py) 说明文档

## 概述

启动器(`launcher.py`)是企业微信直播签到系统的入口程序，其主要职责是提供一个优雅的启动画面和进度条，并负责初始化并执行主程序(`src/main.py`)。启动器采用简洁的设计理念，专注于提供良好的用户启动体验，而将所有业务逻辑和配置处理委托给主程序处理。

## 设计原则

启动器设计遵循以下原则：

1. **职责单一**：只负责启动画面显示和主程序引导，不处理配置、数据库等业务逻辑
2. **最小依赖**：减少对外部库的依赖，以保证启动速度
3. **用户体验优先**：提供美观、有信息量的启动过程展示
4. **错误处理**：妥善处理启动过程中可能出现的异常

## 主要组件

### 1. SplashScreen 类

负责创建和管理启动画面，提供进度显示功能。

主要方法：
- `show()`: 显示启动画面
- `set_progress(value, status_text)`: 设置进度条值和状态文本
- `update()`: 更新启动画面
- `close()`: 关闭启动画面

### 2. 全局异常处理器

使用`sys.excepthook`捕获未处理的异常，并以友好方式呈现给用户。

### 3. 主程序执行逻辑

`main()`函数按以下流程执行：
1. 记录启动信息
2. 显示启动画面
3. 尝试导入主模块(src.main)
4. 更新进度条和状态提示
5. 关闭启动画面
6. 执行主程序

## 进度显示

启动器使用确定模式(determinate)的进度条，根据启动的不同阶段显示对应的百分比和描述文本：
- 0%: 初始化
- 30%: 准备加载模块
- 60%: 正在加载主模块
- 90%: 准备启动应用程序
- 100%: 准备就绪，即将启动

## 实现细节

### 启动画面

使用`tkinter`库创建启动画面，包括：
- 应用名称标题
- 状态文本标签
- 进度条
- 百分比显示
- 版本信息

### 加载主模块

加载主模块采用尝试-错误-修复的策略：
1. 首先尝试直接导入`src.main`
2. 如果失败，检查原因并尝试修复导入路径
3. 对打包后的应用进行特殊处理(检查`sys._MEIPASS`)

### 错误处理

错误处理分为两层：
1. 全局未捕获异常处理：使用`sys.excepthook`
2. 主函数中的try-except块：处理启动过程中的异常

## 使用示例

作为应用程序的入口点，launcher.py通常是被直接执行的：

```bash
# 直接运行
python launcher.py

# 或作为打包后的可执行文件
./企业微信直播签到系统.app  # macOS
企业微信直播签到系统.exe     # Windows
```

## 与其他组件的关系

### 与src/main.py的关系

- launcher.py负责启动画面和初始化环境
- src/main.py负责应用程序的具体逻辑和业务处理
- launcher.py将控制权完全交给main.py后不再干预

### 与配置的关系

launcher.py不处理任何配置逻辑，所有配置均由src/main.py及初始化向导处理。

## 打包考虑

在使用PyInstaller等工具打包时，launcher.py是指定的启动点。启动器会自动处理一些打包后的路径问题，确保主模块能够正确载入。

## 注意事项

1. 不要在launcher.py中添加业务逻辑代码
2. 保持launcher.py的简洁和专注
3. 错误信息应该友好且有帮助
4. 进度显示应该反映实际启动进度
5. 使用tkinter可能导致额外的依赖，但为了良好的跨平台UI效果是值得的 